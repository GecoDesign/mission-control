<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Backlink Outreach Manager - geco.design</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2em;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1em;
        }

        .tabs {
            display: flex;
            background: #f7f7f7;
            border-bottom: 2px solid #e0e0e0;
        }

        .tab {
            flex: 1;
            padding: 15px 20px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1em;
            font-weight: 500;
            color: #666;
            transition: all 0.3s;
        }

        .tab:hover {
            background: #fff;
            color: #667eea;
        }

        .tab.active {
            background: white;
            color: #667eea;
            border-bottom: 3px solid #667eea;
        }

        .tab-content {
            display: none;
            padding: 30px;
        }

        .tab-content.active {
            display: block;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
        }

        .stat-card h3 {
            font-size: 2em;
            margin-bottom: 5px;
        }

        .stat-card p {
            opacity: 0.9;
            font-size: 0.9em;
        }

        .toolbar {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            align-items: center;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.95em;
            font-weight: 500;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #f0f0f0;
            color: #333;
        }

        .btn-secondary:hover {
            background: #e0e0e0;
        }

        .btn-success {
            background: #48bb78;
            color: white;
        }

        .btn-danger {
            background: #f56565;
            color: white;
        }

        .search-input, .filter-select {
            padding: 10px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 0.95em;
            flex: 1;
            min-width: 200px;
        }

        .search-input:focus, .filter-select:focus {
            outline: none;
            border-color: #667eea;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }

        th {
            background: #f7f7f7;
            font-weight: 600;
            color: #333;
        }

        tr:hover {
            background: #f9f9f9;
        }

        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.85em;
            font-weight: 500;
        }

        .status-pending { background: #feebc8; color: #c05621; }
        .status-sent { background: #bee3f8; color: #2c5282; }
        .status-replied { background: #c6f6d5; color: #22543d; }
        .status-success { background: #9ae6b4; color: #22543d; font-weight: 600; }
        .status-declined { background: #fed7d7; color: #742a2a; }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 16px;
            padding: 30px;
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-header h2 {
            color: #333;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 1.5em;
            cursor: pointer;
            color: #999;
        }

        .close-btn:hover {
            color: #333;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #333;
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 0.95em;
            font-family: inherit;
        }

        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }

        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .pipeline {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .pipeline-column {
            background: #f7f7f7;
            border-radius: 12px;
            padding: 15px;
            min-height: 400px;
        }

        .pipeline-column h3 {
            margin-bottom: 15px;
            color: #333;
            font-size: 1.1em;
        }

        .pipeline-card {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: all 0.3s;
        }

        .pipeline-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .pipeline-card h4 {
            color: #333;
            margin-bottom: 5px;
            font-size: 0.95em;
        }

        .pipeline-card p {
            color: #666;
            font-size: 0.85em;
            margin-bottom: 8px;
        }

        .pipeline-card .da-badge {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 2px 8px;
            border-radius: 8px;
            font-size: 0.75em;
            font-weight: 600;
        }

        .template-card {
            background: #f7f7f7;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .template-card:hover {
            background: #eee;
            transform: translateX(5px);
        }

        .template-card h3 {
            color: #333;
            margin-bottom: 10px;
        }

        .template-card p {
            color: #666;
            font-size: 0.9em;
        }

        .action-btn {
            padding: 6px 12px;
            margin: 0 3px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85em;
            transition: all 0.2s;
        }

        .action-btn:hover {
            transform: scale(1.05);
        }

        .notes-section {
            margin-top: 20px;
            padding: 15px;
            background: #f9f9f9;
            border-radius: 8px;
        }

        .note-item {
            background: white;
            padding: 12px;
            margin-bottom: 10px;
            border-left: 4px solid #667eea;
            border-radius: 4px;
        }

        .note-item .note-date {
            color: #999;
            font-size: 0.8em;
            margin-bottom: 5px;
        }

        .chart-container {
            background: #f7f7f7;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #999;
        }

        .empty-state svg {
            width: 80px;
            height: 80px;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .import-export-zone {
            background: #f7f7f7;
            border: 2px dashed #ccc;
            border-radius: 12px;
            padding: 30px;
            text-align: center;
            margin-bottom: 20px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }

            .pipeline {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîó Backlink Outreach Manager</h1>
            <p>Link Building & Outreach Campaign Tracker for geco.design</p>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="switchTab('dashboard')">Dashboard</button>
            <button class="tab" onclick="switchTab('prospects')">Prospects</button>
            <button class="tab" onclick="switchTab('campaigns')">Campaigns</button>
            <button class="tab" onclick="switchTab('templates')">Templates</button>
            <button class="tab" onclick="switchTab('analytics')">Analytics</button>
        </div>

        <!-- Dashboard Tab -->
        <div id="dashboard" class="tab-content active">
            <div class="stats-grid">
                <div class="stat-card">
                    <h3 id="stat-total">0</h3>
                    <p>Total Prospects</p>
                </div>
                <div class="stat-card">
                    <h3 id="stat-sent">0</h3>
                    <p>Outreach Sent</p>
                </div>
                <div class="stat-card">
                    <h3 id="stat-replied">0</h3>
                    <p>Replies Received</p>
                </div>
                <div class="stat-card">
                    <h3 id="stat-success">0</h3>
                    <p>Links Gained</p>
                </div>
                <div class="stat-card">
                    <h3 id="stat-conversion">0%</h3>
                    <p>Conversion Rate</p>
                </div>
            </div>

            <h2 style="margin-bottom: 15px;">Outreach Pipeline</h2>
            <div class="pipeline" id="pipeline">
                <div class="pipeline-column">
                    <h3>üìã Pending (0)</h3>
                    <div id="pipeline-pending"></div>
                </div>
                <div class="pipeline-column">
                    <h3>üìß Sent (0)</h3>
                    <div id="pipeline-sent"></div>
                </div>
                <div class="pipeline-column">
                    <h3>üí¨ Replied (0)</h3>
                    <div id="pipeline-replied"></div>
                </div>
                <div class="pipeline-column">
                    <h3>‚úÖ Success (0)</h3>
                    <div id="pipeline-success"></div>
                </div>
                <div class="pipeline-column">
                    <h3>‚ùå Declined (0)</h3>
                    <div id="pipeline-declined"></div>
                </div>
            </div>
        </div>

        <!-- Prospects Tab -->
        <div id="prospects" class="tab-content">
            <div class="toolbar">
                <button class="btn btn-primary" onclick="openModal('addProspect')">+ Add Prospect</button>
                <button class="btn btn-secondary" onclick="exportCSV()">üì• Export CSV</button>
                <button class="btn btn-secondary" onclick="document.getElementById('csvImport').click()">üì§ Import CSV</button>
                <input type="file" id="csvImport" accept=".csv" style="display:none" onchange="importCSV(event)">
                <input type="search" class="search-input" id="prospectSearch" placeholder="Search prospects..." onkeyup="filterProspects()">
                <select class="filter-select" id="statusFilter" onchange="filterProspects()">
                    <option value="">All Statuses</option>
                    <option value="pending">Pending</option>
                    <option value="sent">Sent</option>
                    <option value="replied">Replied</option>
                    <option value="success">Success</option>
                    <option value="declined">Declined</option>
                </select>
                <select class="filter-select" id="nicheFilter" onchange="filterProspects()">
                    <option value="">All Niches</option>
                </select>
            </div>

            <div id="prospectsTable"></div>
        </div>

        <!-- Campaigns Tab -->
        <div id="campaigns" class="tab-content">
            <div class="toolbar">
                <button class="btn btn-primary" onclick="openModal('addCampaign')">+ New Campaign</button>
            </div>
            <div id="campaignsList"></div>
        </div>

        <!-- Templates Tab -->
        <div id="templates" class="tab-content">
            <div class="toolbar">
                <button class="btn btn-primary" onclick="openModal('addTemplate')">+ New Template</button>
            </div>
            <div id="templatesList"></div>
        </div>

        <!-- Analytics Tab -->
        <div id="analytics" class="tab-content">
            <h2 style="margin-bottom: 20px;">Success Metrics</h2>
            <div class="chart-container">
                <h3>Outreach Performance</h3>
                <div id="performanceChart"></div>
            </div>
            <div class="chart-container">
                <h3>Top Niches by Success Rate</h3>
                <div id="nicheChart"></div>
            </div>
        </div>
    </div>

    <!-- Add Prospect Modal -->
    <div id="addProspectModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Add New Prospect</h2>
                <button class="close-btn" onclick="closeModal('addProspect')">&times;</button>
            </div>
            <form onsubmit="saveProspect(event)">
                <div class="form-group">
                    <label>Website URL *</label>
                    <input type="url" id="prospectUrl" required placeholder="https://example.com">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Contact Name</label>
                        <input type="text" id="prospectName" placeholder="John Doe">
                    </div>
                    <div class="form-group">
                        <label>Contact Email *</label>
                        <input type="email" id="prospectEmail" required placeholder="contact@example.com">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Domain Authority (DA)</label>
                        <input type="number" id="prospectDA" min="0" max="100" placeholder="0-100">
                    </div>
                    <div class="form-group">
                        <label>Niche/Category</label>
                        <input type="text" id="prospectNiche" placeholder="e.g., Design, Tech">
                    </div>
                </div>
                <div class="form-group">
                    <label>Status</label>
                    <select id="prospectStatus">
                        <option value="pending">Pending</option>
                        <option value="sent">Sent</option>
                        <option value="replied">Replied</option>
                        <option value="success">Success</option>
                        <option value="declined">Declined</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Notes</label>
                    <textarea id="prospectNotes" placeholder="Any relevant information..."></textarea>
                </div>
                <button type="submit" class="btn btn-primary" style="width:100%">Save Prospect</button>
            </form>
        </div>
    </div>

    <!-- Add Campaign Modal -->
    <div id="addCampaignModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>New Outreach Campaign</h2>
                <button class="close-btn" onclick="closeModal('addCampaign')">&times;</button>
            </div>
            <form onsubmit="saveCampaign(event)">
                <div class="form-group">
                    <label>Campaign Name *</label>
                    <input type="text" id="campaignName" required placeholder="e.g., Q1 Guest Post Outreach">
                </div>
                <div class="form-group">
                    <label>Select Prospect *</label>
                    <select id="campaignProspect" required></select>
                </div>
                <div class="form-group">
                    <label>Email Template *</label>
                    <select id="campaignTemplate" required></select>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Send Date</label>
                        <input type="date" id="campaignSendDate">
                    </div>
                    <div class="form-group">
                        <label>Follow-up Date</label>
                        <input type="date" id="campaignFollowup">
                    </div>
                </div>
                <div class="form-group">
                    <label>Personalization Notes</label>
                    <textarea id="campaignNotes" placeholder="Any specific customizations for this outreach..."></textarea>
                </div>
                <button type="submit" class="btn btn-primary" style="width:100%">Create Campaign</button>
            </form>
        </div>
    </div>

    <!-- Add Template Modal -->
    <div id="addTemplateModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>New Email Template</h2>
                <button class="close-btn" onclick="closeModal('addTemplate')">&times;</button>
            </div>
            <form onsubmit="saveTemplate(event)">
                <div class="form-group">
                    <label>Template Name *</label>
                    <input type="text" id="templateName" required placeholder="e.g., Guest Post Pitch">
                </div>
                <div class="form-group">
                    <label>Template Type *</label>
                    <select id="templateType" required>
                        <option value="guest-post">Guest Post</option>
                        <option value="resource-link">Resource Link</option>
                        <option value="broken-link">Broken Link</option>
                        <option value="testimonial">Testimonial</option>
                        <option value="infographic">Infographic Outreach</option>
                        <option value="follow-up">Follow-up</option>
                        <option value="custom">Custom</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Subject Line *</label>
                    <input type="text" id="templateSubject" required placeholder="Email subject">
                </div>
                <div class="form-group">
                    <label>Email Body *</label>
                    <textarea id="templateBody" required placeholder="Use {name}, {website}, {your_site} as placeholders..." style="min-height: 200px;"></textarea>
                </div>
                <div class="form-group">
                    <label>Description</label>
                    <input type="text" id="templateDesc" placeholder="When to use this template...">
                </div>
                <button type="submit" class="btn btn-primary" style="width:100%">Save Template</button>
            </form>
        </div>
    </div>

    <!-- Edit/View Prospect Modal -->
    <div id="editProspectModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Prospect Details</h2>
                <button class="close-btn" onclick="closeModal('editProspect')">&times;</button>
            </div>
            <form onsubmit="updateProspect(event)">
                <input type="hidden" id="editProspectId">
                <div class="form-group">
                    <label>Website URL *</label>
                    <input type="url" id="editProspectUrl" required>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Contact Name</label>
                        <input type="text" id="editProspectName">
                    </div>
                    <div class="form-group">
                        <label>Contact Email *</label>
                        <input type="email" id="editProspectEmail" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Domain Authority (DA)</label>
                        <input type="number" id="editProspectDA" min="0" max="100">
                    </div>
                    <div class="form-group">
                        <label>Niche/Category</label>
                        <input type="text" id="editProspectNiche">
                    </div>
                </div>
                <div class="form-group">
                    <label>Status</label>
                    <select id="editProspectStatus">
                        <option value="pending">Pending</option>
                        <option value="sent">Sent</option>
                        <option value="replied">Replied</option>
                        <option value="success">Success</option>
                        <option value="declined">Declined</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Notes</label>
                    <textarea id="editProspectNotes"></textarea>
                </div>
                
                <div class="notes-section">
                    <h3 style="margin-bottom: 10px;">Conversation History</h3>
                    <div id="conversationHistory"></div>
                    <div class="form-group" style="margin-top: 15px;">
                        <label>Add Note</label>
                        <textarea id="newNote" placeholder="Add a note about this conversation..."></textarea>
                        <button type="button" class="btn btn-secondary" onclick="addNote()" style="margin-top: 10px;">Add Note</button>
                    </div>
                </div>

                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button type="submit" class="btn btn-primary" style="flex: 1;">Update Prospect</button>
                    <button type="button" class="btn btn-danger" onclick="deleteProspect()">Delete</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Data structures
        let prospects = [];
        let campaigns = [];
        let templates = [];

        // Initialize app
        function init() {
            loadData();
            renderDashboard();
            renderProspects();
            renderCampaigns();
            renderTemplates();
            renderAnalytics();
            populateNicheFilter();
            createDefaultTemplates();
        }

        // Local Storage
        function saveData() {
            localStorage.setItem('backlinkProspects', JSON.stringify(prospects));
            localStorage.setItem('backlinkCampaigns', JSON.stringify(campaigns));
            localStorage.setItem('backlinkTemplates', JSON.stringify(templates));
        }

        function loadData() {
            prospects = JSON.parse(localStorage.getItem('backlinkProspects')) || [];
            campaigns = JSON.parse(localStorage.getItem('backlinkCampaigns')) || [];
            templates = JSON.parse(localStorage.getItem('backlinkTemplates')) || [];
        }

        // Tab switching
        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
            
            // Refresh content when switching tabs
            if (tabName === 'dashboard') renderDashboard();
            if (tabName === 'prospects') renderProspects();
            if (tabName === 'campaigns') renderCampaigns();
            if (tabName === 'templates') renderTemplates();
            if (tabName === 'analytics') renderAnalytics();
        }

        // Modal functions
        function openModal(modalName) {
            const modal = document.getElementById(modalName + 'Modal');
            modal.classList.add('active');
            
            // Populate dropdowns if needed
            if (modalName === 'addCampaign') {
                populateCampaignDropdowns();
            }
        }

        function closeModal(modalName) {
            const modal = document.getElementById(modalName + 'Modal');
            modal.classList.remove('active');
            
            // Reset forms
            modal.querySelectorAll('form').forEach(form => form.reset());
        }

        // Prospect functions
        function saveProspect(event) {
            event.preventDefault();
            
            const prospect = {
                id: Date.now(),
                url: document.getElementById('prospectUrl').value,
                name: document.getElementById('prospectName').value,
                email: document.getElementById('prospectEmail').value,
                da: document.getElementById('prospectDA').value,
                niche: document.getElementById('prospectNiche').value,
                status: document.getElementById('prospectStatus').value,
                notes: document.getElementById('prospectNotes').value,
                conversationHistory: [],
                dateAdded: new Date().toISOString()
            };
            
            prospects.push(prospect);
            saveData();
            closeModal('addProspect');
            renderProspects();
            renderDashboard();
            populateNicheFilter();
        }

        function updateProspect(event) {
            event.preventDefault();
            
            const id = parseInt(document.getElementById('editProspectId').value);
            const index = prospects.findIndex(p => p.id === id);
            
            if (index !== -1) {
                prospects[index].url = document.getElementById('editProspectUrl').value;
                prospects[index].name = document.getElementById('editProspectName').value;
                prospects[index].email = document.getElementById('editProspectEmail').value;
                prospects[index].da = document.getElementById('editProspectDA').value;
                prospects[index].niche = document.getElementById('editProspectNiche').value;
                prospects[index].status = document.getElementById('editProspectStatus').value;
                prospects[index].notes = document.getElementById('editProspectNotes').value;
                
                saveData();
                closeModal('editProspect');
                renderProspects();
                renderDashboard();
            }
        }

        function deleteProspect() {
            if (!confirm('Are you sure you want to delete this prospect?')) return;
            
            const id = parseInt(document.getElementById('editProspectId').value);
            prospects = prospects.filter(p => p.id !== id);
            
            saveData();
            closeModal('editProspect');
            renderProspects();
            renderDashboard();
        }

        function editProspect(id) {
            const prospect = prospects.find(p => p.id === id);
            if (!prospect) return;
            
            document.getElementById('editProspectId').value = prospect.id;
            document.getElementById('editProspectUrl').value = prospect.url;
            document.getElementById('editProspectName').value = prospect.name || '';
            document.getElementById('editProspectEmail').value = prospect.email;
            document.getElementById('editProspectDA').value = prospect.da || '';
            document.getElementById('editProspectNiche').value = prospect.niche || '';
            document.getElementById('editProspectStatus').value = prospect.status;
            document.getElementById('editProspectNotes').value = prospect.notes || '';
            
            renderConversationHistory(prospect);
            
            openModal('editProspect');
        }

        function renderConversationHistory(prospect) {
            const container = document.getElementById('conversationHistory');
            if (!prospect.conversationHistory || prospect.conversationHistory.length === 0) {
                container.innerHTML = '<p style="color: #999; text-align: center;">No conversation notes yet</p>';
                return;
            }
            
            container.innerHTML = prospect.conversationHistory.map(note => `
                <div class="note-item">
                    <div class="note-date">${new Date(note.date).toLocaleDateString()} ${new Date(note.date).toLocaleTimeString()}</div>
                    <div>${note.text}</div>
                </div>
            `).join('');
        }

        function addNote() {
            const noteText = document.getElementById('newNote').value.trim();
            if (!noteText) return;
            
            const id = parseInt(document.getElementById('editProspectId').value);
            const prospect = prospects.find(p => p.id === id);
            
            if (prospect) {
                if (!prospect.conversationHistory) {
                    prospect.conversationHistory = [];
                }
                
                prospect.conversationHistory.push({
                    date: new Date().toISOString(),
                    text: noteText
                });
                
                saveData();
                renderConversationHistory(prospect);
                document.getElementById('newNote').value = '';
            }
        }

        function renderProspects() {
            const container = document.getElementById('prospectsTable');
            
            if (prospects.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <svg fill="currentColor" viewBox="0 0 20 20">
                            <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                            <path fill-rule="evenodd" d="M4 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v11a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3zm-3 4a1 1 0 100 2h.01a1 1 0 100-2H7zm3 0a1 1 0 100 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                        </svg>
                        <h3>No prospects yet</h3>
                        <p>Add your first prospect to start tracking outreach</p>
                    </div>
                `;
                return;
            }
            
            const filteredProspects = filterProspectsData();
            
            container.innerHTML = `
                <table>
                    <thead>
                        <tr>
                            <th>Website</th>
                            <th>Contact</th>
                            <th>Email</th>
                            <th>DA</th>
                            <th>Niche</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${filteredProspects.map(p => `
                            <tr>
                                <td><a href="${p.url}" target="_blank">${new URL(p.url).hostname}</a></td>
                                <td>${p.name || '-'}</td>
                                <td>${p.email}</td>
                                <td>${p.da || '-'}</td>
                                <td>${p.niche || '-'}</td>
                                <td><span class="status-badge status-${p.status}">${p.status}</span></td>
                                <td>
                                    <button class="action-btn btn-primary" onclick="editProspect(${p.id})">View</button>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
        }

        function filterProspectsData() {
            const search = document.getElementById('prospectSearch').value.toLowerCase();
            const statusFilter = document.getElementById('statusFilter').value;
            const nicheFilter = document.getElementById('nicheFilter').value;
            
            return prospects.filter(p => {
                const matchesSearch = !search || 
                    p.url.toLowerCase().includes(search) ||
                    (p.name && p.name.toLowerCase().includes(search)) ||
                    p.email.toLowerCase().includes(search) ||
                    (p.niche && p.niche.toLowerCase().includes(search));
                
                const matchesStatus = !statusFilter || p.status === statusFilter;
                const matchesNiche = !nicheFilter || p.niche === nicheFilter;
                
                return matchesSearch && matchesStatus && matchesNiche;
            });
        }

        function filterProspects() {
            renderProspects();
        }

        function populateNicheFilter() {
            const niches = [...new Set(prospects.map(p => p.niche).filter(n => n))];
            const select = document.getElementById('nicheFilter');
            const currentValue = select.value;
            
            select.innerHTML = '<option value="">All Niches</option>' +
                niches.map(n => `<option value="${n}">${n}</option>`).join('');
            
            select.value = currentValue;
        }

        // Campaign functions
        function saveCampaign(event) {
            event.preventDefault();
            
            const campaign = {
                id: Date.now(),
                name: document.getElementById('campaignName').value,
                prospectId: parseInt(document.getElementById('campaignProspect').value),
                templateId: parseInt(document.getElementById('campaignTemplate').value),
                sendDate: document.getElementById('campaignSendDate').value,
                followupDate: document.getElementById('campaignFollowup').value,
                notes: document.getElementById('campaignNotes').value,
                dateCreated: new Date().toISOString()
            };
            
            campaigns.push(campaign);
            saveData();
            closeModal('addCampaign');
            renderCampaigns();
        }

        function renderCampaigns() {
            const container = document.getElementById('campaignsList');
            
            if (campaigns.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <svg fill="currentColor" viewBox="0 0 20 20">
                            <path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z"></path>
                            <path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z"></path>
                        </svg>
                        <h3>No campaigns yet</h3>
                        <p>Create your first outreach campaign</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = `
                <table>
                    <thead>
                        <tr>
                            <th>Campaign</th>
                            <th>Prospect</th>
                            <th>Template</th>
                            <th>Send Date</th>
                            <th>Follow-up</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${campaigns.map(c => {
                            const prospect = prospects.find(p => p.id === c.prospectId);
                            const template = templates.find(t => t.id === c.templateId);
                            return `
                                <tr>
                                    <td><strong>${c.name}</strong></td>
                                    <td>${prospect ? new URL(prospect.url).hostname : 'Unknown'}</td>
                                    <td>${template ? template.name : 'Unknown'}</td>
                                    <td>${c.sendDate || '-'}</td>
                                    <td>${c.followupDate || '-'}</td>
                                    <td>
                                        <button class="action-btn btn-primary" onclick="viewCampaign(${c.id})">View</button>
                                        <button class="action-btn btn-danger" onclick="deleteCampaign(${c.id})">Delete</button>
                                    </td>
                                </tr>
                            `;
                        }).join('')}
                    </tbody>
                </table>
            `;
        }

        function deleteCampaign(id) {
            if (!confirm('Delete this campaign?')) return;
            campaigns = campaigns.filter(c => c.id !== id);
            saveData();
            renderCampaigns();
        }

        function viewCampaign(id) {
            const campaign = campaigns.find(c => c.id === id);
            const prospect = prospects.find(p => p.id === campaign.prospectId);
            const template = templates.find(t => t.id === campaign.templateId);
            
            if (!campaign || !prospect || !template) return;
            
            const personalizedBody = template.body
                .replace(/{name}/g, prospect.name || 'there')
                .replace(/{website}/g, new URL(prospect.url).hostname)
                .replace(/{your_site}/g, 'geco.design');
            
            alert(`Campaign: ${campaign.name}\n\nTo: ${prospect.email}\n\nSubject: ${template.subject}\n\n${personalizedBody}\n\nNotes: ${campaign.notes || 'None'}`);
        }

        function populateCampaignDropdowns() {
            const prospectSelect = document.getElementById('campaignProspect');
            const templateSelect = document.getElementById('campaignTemplate');
            
            prospectSelect.innerHTML = prospects.map(p => 
                `<option value="${p.id}">${new URL(p.url).hostname} - ${p.email}</option>`
            ).join('');
            
            templateSelect.innerHTML = templates.map(t => 
                `<option value="${t.id}">${t.name} (${t.type})</option>`
            ).join('');
        }

        // Template functions
        function saveTemplate(event) {
            event.preventDefault();
            
            const template = {
                id: Date.now(),
                name: document.getElementById('templateName').value,
                type: document.getElementById('templateType').value,
                subject: document.getElementById('templateSubject').value,
                body: document.getElementById('templateBody').value,
                description: document.getElementById('templateDesc').value,
                dateCreated: new Date().toISOString()
            };
            
            templates.push(template);
            saveData();
            closeModal('addTemplate');
            renderTemplates();
        }

        function renderTemplates() {
            const container = document.getElementById('templatesList');
            
            if (templates.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <svg fill="currentColor" viewBox="0 0 20 20">
                            <path d="M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4z"></path>
                        </svg>
                        <h3>No templates yet</h3>
                        <p>Create email templates for your outreach campaigns</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = templates.map(t => `
                <div class="template-card" onclick="viewTemplate(${t.id})">
                    <h3>${t.name}</h3>
                    <p><strong>Type:</strong> ${t.type} | <strong>Subject:</strong> ${t.subject}</p>
                    <p>${t.description || t.body.substring(0, 100) + '...'}</p>
                    <button class="action-btn btn-danger" onclick="event.stopPropagation(); deleteTemplate(${t.id})">Delete</button>
                </div>
            `).join('');
        }

        function viewTemplate(id) {
            const template = templates.find(t => t.id === id);
            if (!template) return;
            
            alert(`Template: ${template.name}\n\nType: ${template.type}\n\nSubject: ${template.subject}\n\nBody:\n${template.body}\n\nDescription: ${template.description || 'None'}\n\nPlaceholders: {name}, {website}, {your_site}`);
        }

        function deleteTemplate(id) {
            if (!confirm('Delete this template?')) return;
            templates = templates.filter(t => t.id !== id);
            saveData();
            renderTemplates();
        }

        function createDefaultTemplates() {
            if (templates.length > 0) return;
            
            templates = [
                {
                    id: Date.now(),
                    name: 'Guest Post Pitch',
                    type: 'guest-post',
                    subject: 'Guest Post Contribution for {website}',
                    body: 'Hi {name},\n\nI\'m Alex from {your_site}, a web design studio specializing in branding and digital experiences.\n\nI\'ve been following {website} and love your content on [topic]. I\'d like to contribute a guest post that would provide value to your readers.\n\nSome topic ideas:\n- [Topic 1]\n- [Topic 2]\n- [Topic 3]\n\nI can also include original graphics and case studies from our work. Would you be interested?\n\nBest regards,\nAlex',
                    description: 'Initial guest post outreach'
                },
                {
                    id: Date.now() + 1,
                    name: 'Resource Link Request',
                    type: 'resource-link',
                    subject: 'Resource suggestion for {website}',
                    body: 'Hi {name},\n\nI was reading your article on [topic] at {website} and found it really valuable.\n\nI noticed you mentioned [related topic]. We recently published a comprehensive guide on this at {your_site} that your readers might find helpful: [URL]\n\nIt covers:\n- [Key point 1]\n- [Key point 2]\n- [Key point 3]\n\nWould you consider adding it as a resource? Happy to return the favor.\n\nCheers,\nAlex',
                    description: 'Suggesting a resource link'
                },
                {
                    id: Date.now() + 2,
                    name: 'Follow-up (No Response)',
                    type: 'follow-up',
                    subject: 'Re: [Original Subject]',
                    body: 'Hi {name},\n\nJust wanted to follow up on my previous email about [topic]. I understand you\'re busy, but I\'d love to hear your thoughts.\n\nLet me know if you\'re interested or if there\'s a better time to discuss this.\n\nBest,\nAlex',
                    description: 'Polite follow-up after no response'
                }
            ];
            
            saveData();
        }

        // Dashboard & Analytics
        function renderDashboard() {
            updateStats();
            renderPipeline();
        }

        function updateStats() {
            const total = prospects.length;
            const sent = prospects.filter(p => ['sent', 'replied', 'success'].includes(p.status)).length;
            const replied = prospects.filter(p => ['replied', 'success'].includes(p.status)).length;
            const success = prospects.filter(p => p.status === 'success').length;
            const conversion = sent > 0 ? Math.round((success / sent) * 100) : 0;
            
            document.getElementById('stat-total').textContent = total;
            document.getElementById('stat-sent').textContent = sent;
            document.getElementById('stat-replied').textContent = replied;
            document.getElementById('stat-success').textContent = success;
            document.getElementById('stat-conversion').textContent = conversion + '%';
        }

        function renderPipeline() {
            const statuses = ['pending', 'sent', 'replied', 'success', 'declined'];
            
            statuses.forEach(status => {
                const container = document.getElementById('pipeline-' + status);
                const filtered = prospects.filter(p => p.status === status);
                
                // Update count in header
                const header = container.parentElement.querySelector('h3');
                const emoji = header.textContent.split(' ')[0];
                const statusName = status.charAt(0).toUpperCase() + status.slice(1);
                header.textContent = `${emoji} ${statusName} (${filtered.length})`;
                
                container.innerHTML = filtered.map(p => `
                    <div class="pipeline-card" onclick="editProspect(${p.id})">
                        <h4>${new URL(p.url).hostname}</h4>
                        <p>${p.email}</p>
                        ${p.da ? `<span class="da-badge">DA ${p.da}</span>` : ''}
                        ${p.niche ? `<span style="font-size: 0.8em; color: #999;"> ‚Ä¢ ${p.niche}</span>` : ''}
                    </div>
                `).join('');
            });
        }

        function renderAnalytics() {
            const container = document.getElementById('performanceChart');
            const total = prospects.length;
            const pending = prospects.filter(p => p.status === 'pending').length;
            const sent = prospects.filter(p => p.status === 'sent').length;
            const replied = prospects.filter(p => p.status === 'replied').length;
            const success = prospects.filter(p => p.status === 'success').length;
            const declined = prospects.filter(p => p.status === 'declined').length;
            
            container.innerHTML = `
                <div style="margin: 20px 0;">
                    <div style="margin-bottom: 10px;"><strong>Pending:</strong> ${pending} (${total > 0 ? Math.round(pending/total*100) : 0}%)</div>
                    <div style="background: #feebc8; height: 30px; width: ${total > 0 ? pending/total*100 : 0}%; border-radius: 4px;"></div>
                </div>
                <div style="margin: 20px 0;">
                    <div style="margin-bottom: 10px;"><strong>Sent:</strong> ${sent} (${total > 0 ? Math.round(sent/total*100) : 0}%)</div>
                    <div style="background: #bee3f8; height: 30px; width: ${total > 0 ? sent/total*100 : 0}%; border-radius: 4px;"></div>
                </div>
                <div style="margin: 20px 0;">
                    <div style="margin-bottom: 10px;"><strong>Replied:</strong> ${replied} (${total > 0 ? Math.round(replied/total*100) : 0}%)</div>
                    <div style="background: #c6f6d5; height: 30px; width: ${total > 0 ? replied/total*100 : 0}%; border-radius: 4px;"></div>
                </div>
                <div style="margin: 20px 0;">
                    <div style="margin-bottom: 10px;"><strong>Success:</strong> ${success} (${total > 0 ? Math.round(success/total*100) : 0}%)</div>
                    <div style="background: #9ae6b4; height: 30px; width: ${total > 0 ? success/total*100 : 0}%; border-radius: 4px;"></div>
                </div>
                <div style="margin: 20px 0;">
                    <div style="margin-bottom: 10px;"><strong>Declined:</strong> ${declined} (${total > 0 ? Math.round(declined/total*100) : 0}%)</div>
                    <div style="background: #fed7d7; height: 30px; width: ${total > 0 ? declined/total*100 : 0}%; border-radius: 4px;"></div>
                </div>
            `;
            
            // Niche analysis
            const nicheContainer = document.getElementById('nicheChart');
            const nicheStats = {};
            
            prospects.forEach(p => {
                const niche = p.niche || 'Uncategorized';
                if (!nicheStats[niche]) {
                    nicheStats[niche] = { total: 0, success: 0 };
                }
                nicheStats[niche].total++;
                if (p.status === 'success') {
                    nicheStats[niche].success++;
                }
            });
            
            const sortedNiches = Object.entries(nicheStats)
                .map(([niche, stats]) => ({
                    niche,
                    total: stats.total,
                    success: stats.success,
                    rate: stats.total > 0 ? (stats.success / stats.total * 100).toFixed(1) : 0
                }))
                .sort((a, b) => b.rate - a.rate);
            
            nicheContainer.innerHTML = sortedNiches.length > 0 ? sortedNiches.map(n => `
                <div style="margin: 20px 0;">
                    <div style="margin-bottom: 10px;"><strong>${n.niche}:</strong> ${n.success}/${n.total} (${n.rate}% success)</div>
                    <div style="background: linear-gradient(90deg, #667eea ${n.rate}%, #e0e0e0 ${n.rate}%); height: 30px; border-radius: 4px;"></div>
                </div>
            `).join('') : '<p style="text-align: center; color: #999;">No data yet</p>';
        }

        // CSV Import/Export
        function exportCSV() {
            const headers = ['Website URL', 'Contact Name', 'Email', 'DA', 'Niche', 'Status', 'Notes', 'Date Added'];
            const rows = prospects.map(p => [
                p.url,
                p.name || '',
                p.email,
                p.da || '',
                p.niche || '',
                p.status,
                p.notes || '',
                new Date(p.dateAdded).toLocaleDateString()
            ]);
            
            const csv = [headers, ...rows]
                .map(row => row.map(cell => `"${cell}"`).join(','))
                .join('\n');
            
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `backlink-prospects-${new Date().toISOString().split('T')[0]}.csv`;
            a.click();
            URL.revokeObjectURL(url);
        }

        function importCSV(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const text = e.target.result;
                const lines = text.split('\n');
                const headers = lines[0].split(',').map(h => h.replace(/"/g, '').trim());
                
                for (let i = 1; i < lines.length; i++) {
                    if (!lines[i].trim()) continue;
                    
                    const values = lines[i].split(',').map(v => v.replace(/"/g, '').trim());
                    
                    const prospect = {
                        id: Date.now() + i,
                        url: values[0],
                        name: values[1],
                        email: values[2],
                        da: values[3],
                        niche: values[4],
                        status: values[5] || 'pending',
                        notes: values[6] || '',
                        conversationHistory: [],
                        dateAdded: new Date().toISOString()
                    };
                    
                    if (prospect.url && prospect.email) {
                        prospects.push(prospect);
                    }
                }
                
                saveData();
                renderProspects();
                renderDashboard();
                populateNicheFilter();
                alert(`Imported ${lines.length - 1} prospects successfully!`);
            };
            
            reader.readAsText(file);
            event.target.value = '';
        }

        // Initialize on load
        window.addEventListener('load', init);
    </script>
</body>
</html>